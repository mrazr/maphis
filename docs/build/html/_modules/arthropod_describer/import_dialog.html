<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>arthropod_describer.import_dialog &mdash; MAPHIS 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> MAPHIS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">arthropod_describer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MAPHIS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>arthropod_describer.import_dialog</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for arthropod_describer.import_dialog</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">Future</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">IntEnum</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">PySide2</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">qimage2ndarray</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QAbstractItemModel</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">QAbstractTableModel</span><span class="p">,</span> <span class="n">QRegExp</span><span class="p">,</span> <span class="n">QSize</span><span class="p">,</span> \
    <span class="n">QTimer</span><span class="p">,</span> <span class="n">QDir</span>
<span class="kn">from</span> <span class="nn">PySide2.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span><span class="p">,</span> <span class="n">QRegExpValidator</span><span class="p">,</span> <span class="n">QPixmap</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QDialogButtonBox</span><span class="p">,</span> <span class="n">QCompleter</span><span class="p">,</span> <span class="n">QFileSystemModel</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">,</span> \
    <span class="n">QStyledItemDelegate</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QStyleOptionViewItem</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QHeaderView</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> \
    <span class="n">QTableView</span>

<span class="kn">from</span> <span class="nn">arthropod_describer.common.image_operation_binding</span> <span class="kn">import</span> <span class="n">ResizeWidget</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.label_image</span> <span class="kn">import</span> <span class="n">LabelImgType</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.local_storage</span> <span class="kn">import</span> <span class="n">IMAGE_REFEX</span><span class="p">,</span> <span class="n">restructure_folder</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.scale_setting_widget</span> <span class="kn">import</span> <span class="n">ScaleSettingWidget</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.state</span> <span class="kn">import</span> <span class="n">State</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.units</span> <span class="kn">import</span> <span class="n">Value</span><span class="p">,</span> <span class="n">UnitStore</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.common.utils</span> <span class="kn">import</span> <span class="n">choose_folder</span><span class="p">,</span> <span class="n">get_scale_line_ends</span><span class="p">,</span> <span class="n">get_scale_marker_roi</span><span class="p">,</span> \
    <span class="n">get_reference_length</span><span class="p">,</span> <span class="n">ScaleLineInfo</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.image_viewer</span> <span class="kn">import</span> <span class="n">ImageViewer</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.import_utils</span> <span class="kn">import</span> <span class="n">TempStorage</span><span class="p">,</span> <span class="n">TempPhoto</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.thumbnail_storage</span> <span class="kn">import</span> <span class="n">ThumbnailDelegate</span><span class="p">,</span> <span class="n">ThumbnailStorage_</span>
<span class="kn">from</span> <span class="nn">arthropod_describer.ui_import_dialog</span> <span class="kn">import</span> <span class="n">Ui_ImportDialog</span>

<span class="n">TXT_EXTRACT_SCALE</span> <span class="o">=</span> <span class="s1">&#39;Extract scale from scale markers&#39;</span>
<span class="n">TXT_PLEASE_NAVIGATE_TO_PHOTOS</span> <span class="o">=</span> <span class="s1">&#39;Please navigate to a folder with photos.&#39;</span>


<span class="n">COL_IMPORT</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">COL_THUMB</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">COL_NAME</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">COL_SRC_SIZE</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">COL_DST_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">COL_SCALE</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># COL_ROTATION = 6</span>
<span class="n">COL_SCALE_MARKER</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">COL_REF_LENGTH</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">COL_PHOTO_FOLDER</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">COL_PHOTO_TAG</span> <span class="o">=</span> <span class="mi">9</span>


<div class="viewcode-block" id="ImportAction"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportAction">[docs]</a><span class="k">class</span> <span class="nc">ImportAction</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">ImportPhotos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">CreateProject</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span></div>


<div class="viewcode-block" id="mp_recognize_scales"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.mp_recognize_scales">[docs]</a><span class="k">def</span> <span class="nf">mp_recognize_scales</span><span class="p">(</span><span class="n">img_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">result_queue</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">,</span> <span class="n">ev</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">):</span>
    <span class="n">unit_store</span> <span class="o">=</span> <span class="n">UnitStore</span><span class="p">()</span>
    <span class="n">dig_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([0-9]+)\s*([a-zA-Z]m)&#39;</span><span class="p">)</span>
    <span class="n">_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">img_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">img_paths</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ev</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;event is set, i shall finish now&#39;</span><span class="p">)</span>
            <span class="n">result_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># print(f&#39;{_time} alive on {img_path}&#39;)</span>
        <span class="c1"># photo: TempPhoto = self.temp_storage.get_photo_by_idx(i, True)</span>
        <span class="c1"># print(f&#39;detecting in {img_path}&#39;)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span>
        <span class="n">scale_marker</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_scale_marker_roi</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">ref_length</span><span class="p">,</span> <span class="n">scale_rotated</span> <span class="o">=</span> <span class="n">get_reference_length</span><span class="p">(</span><span class="n">scale_marker</span><span class="p">)</span>
        <span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span> <span class="o">=</span> <span class="n">get_scale_line_ends</span><span class="p">(</span><span class="n">scale_marker</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p1x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_length</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">dig_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ref_length</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">unit_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">unit_store</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">unit_str</span><span class="p">]</span>
            <span class="n">ref_length</span> <span class="o">=</span> <span class="n">Value</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
            <span class="n">px_length</span> <span class="o">=</span> <span class="n">Value</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">p1x</span> <span class="o">-</span> <span class="n">p2x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1x</span> <span class="o">-</span> <span class="n">p2x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">p1y</span> <span class="o">-</span> <span class="n">p2y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">p1y</span> <span class="o">-</span> <span class="n">p2y</span><span class="p">)))),</span>
                              <span class="n">unit_store</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="s1">&#39;px&#39;</span><span class="p">])</span>
            <span class="n">image_scale</span> <span class="o">=</span> <span class="n">px_length</span> <span class="o">/</span> <span class="n">ref_length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ref_length</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">image_scale</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">px_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">p1x_</span><span class="p">,</span> <span class="n">p1y_</span><span class="p">,</span> <span class="n">p2x_</span><span class="p">,</span> <span class="n">p2y_</span> <span class="o">=</span> <span class="n">get_scale_line_ends</span><span class="p">(</span><span class="n">scale_rotated</span><span class="p">)</span>
        <span class="n">scale_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">scale_rotated</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_GRAY2RGB</span><span class="p">)</span>
        <span class="n">scale_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">scale_rotated</span><span class="p">,</span> <span class="p">(</span><span class="n">p1x_</span><span class="p">,</span> <span class="n">p1y_</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="n">p1x_</span><span class="p">,</span> <span class="n">p1y_</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">scale_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">scale_rotated</span><span class="p">,</span> <span class="p">(</span><span class="n">p2x_</span><span class="p">,</span> <span class="n">p1y_</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="n">p2x_</span><span class="p">,</span> <span class="n">p1y_</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">scale_rotated</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">scale_rotated</span><span class="p">,</span> <span class="p">(</span><span class="mi">154</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_LINEAR</span><span class="p">)</span>
        <span class="c1"># pixmap = QPixmap.fromImage(qimage2ndarray.array2qimage(scale_rotated))</span>
        <span class="n">scale_marker</span> <span class="o">=</span> <span class="n">scale_rotated</span>

        <span class="n">result_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">((</span><span class="n">idx</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">,</span> <span class="n">ref_length</span><span class="p">,</span> <span class="n">px_length</span><span class="p">,</span> <span class="p">(</span><span class="n">p1x</span><span class="o">+</span><span class="n">left</span><span class="p">,</span> <span class="n">p1y</span><span class="o">+</span><span class="n">top</span><span class="p">,</span> <span class="n">p2x</span><span class="o">+</span><span class="n">left</span><span class="p">,</span> <span class="n">p2y</span><span class="o">+</span><span class="n">top</span><span class="p">),</span> <span class="n">scale_marker</span><span class="p">,</span>
                                 <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)))</span>
    <span class="n">result_queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImportDialog"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog">[docs]</a><span class="k">class</span> <span class="nc">ImportDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="n">import_btn_clicked</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">copying_finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">([</span><span class="n">Path</span><span class="p">,</span> <span class="nb">list</span><span class="p">])</span>
    <span class="n">open_project</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">([</span><span class="n">Path</span><span class="p">,</span> <span class="n">TempStorage</span><span class="p">])</span>
    <span class="n">import_photos</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="n">TempStorage</span><span class="p">)</span> <span class="c1">#Signal(list)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">f</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowFlags</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowFlags</span><span class="p">()):</span>
        <span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images_to_copy</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span><span class="p">:</span> <span class="n">ImportAction</span> <span class="o">=</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">Ui_ImportDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TempStorage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self.thumbnail_storage: ThumbnailStorage = ThumbnailStorage(thumb_size=(128, 64))</span>
        <span class="c1"># self.thumbnail_delegate: ThumbnailDelegate = ThumbnailDelegate(self.thumbnail_storage)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_delegate</span><span class="p">:</span> <span class="n">ThumbnailDelegate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="p">:</span> <span class="n">ImageImportTableModel</span> <span class="o">=</span> <span class="n">ImageImportTableModel</span><span class="p">()</span>
        <span class="c1"># self.image_list_model.set_thumbnail_storage(self.thumbnail_storage)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">import_status_changed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_status_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">doubleClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_double_click_on_table</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">State</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="p">:</span> <span class="n">QTimer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_update_scale_info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_stop_event</span><span class="p">:</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_resize_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_import_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_resolution_setter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_image_op</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_import_button_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale_recognition_left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="c1"># If the scale recognition is not running, set the appropriate button text (&quot;Import&quot; or &quot;Create&quot;).</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Create&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Import&quot;</span><span class="p">)</span>
        <span class="c1"># If the scale recognition is running, and we got info about progress, display it.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;…reading scale (</span><span class="si">{</span><span class="n">scale_recognition_left</span><span class="si">}</span><span class="s2"> photo</span><span class="si">{</span><span class="s1">&#39;s&#39;</span> <span class="k">if</span> <span class="n">scale_recognition_left</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2"> left)…&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_scale_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span><span class="o">.</span><span class="n">get_nowait</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TXT_EXTRACT_SCALE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_switch_to_normal_state</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">image_scale</span><span class="p">,</span> <span class="n">ref_length</span><span class="p">,</span> <span class="n">px_length</span><span class="p">,</span> <span class="p">(</span><span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">,</span> <span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">),</span> <span class="n">scale_marker</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos_to_import</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="c1">#self.temp_storage.get_photo_by_idx(idx, False)</span>
            <span class="c1"># photo.image_scale = image_scale</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_update_import_button_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span><span class="p">)</span>
            <span class="n">sc_setting</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">scale_setting</span>
            <span class="n">sc_setting</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">image_scale</span>
            <span class="n">sc_setting</span><span class="o">.</span><span class="n">reference_length</span> <span class="o">=</span> <span class="n">ref_length</span>
            <span class="n">sc_setting</span><span class="o">.</span><span class="n">scale_line</span> <span class="o">=</span> <span class="n">ScaleLineInfo</span><span class="p">(</span>
                <span class="n">p1</span><span class="o">=</span><span class="p">(</span><span class="n">p1x</span><span class="p">,</span> <span class="n">p1y</span><span class="p">),</span>
                <span class="n">p2</span><span class="o">=</span><span class="p">(</span><span class="n">p2x</span><span class="p">,</span> <span class="n">p2y</span><span class="p">),</span>
                <span class="n">length</span><span class="o">=</span><span class="n">px_length</span>
            <span class="p">)</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">scale_marker</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">qimage2ndarray</span><span class="o">.</span><span class="n">array2qimage</span><span class="p">(</span><span class="n">scale_marker</span><span class="p">))</span>

            <span class="n">sc_setting</span><span class="o">.</span><span class="n">scale_marker_bbox</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="n">sc_setting</span><span class="o">.</span><span class="n">scale_marker_img</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">scale_marker</span>

            <span class="n">photo</span><span class="o">.</span><span class="n">scale_setting</span> <span class="o">=</span> <span class="n">sc_setting</span>

            <span class="c1"># photo.import_info.scale_info = photo.scale_setting</span>
            <span class="c1"># photo.import_info.original_scale_info = photo.import_info.scale_info</span>
            <span class="c1"># photo.import_info.scale_marker = scale_marker</span>

            <span class="c1"># photo.ref_length = ref_length</span>
            <span class="c1"># ruler = self.ruler_tools[idx]</span>
            <span class="c1"># ruler.set_line(QPoint(p1x, p1y), QPoint(p2x, p2y))</span>
            <span class="n">s_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">COL_SCALE</span><span class="p">)</span>
            <span class="n">e_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">COL_REF_LENGTH</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">s_index</span><span class="p">,</span> <span class="n">e_index</span><span class="p">,</span>
                                                   <span class="p">[</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DecorationRole</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_handle_scales_accepted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span><span class="p">):</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">scale_set_tuple</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">scale_settings</span><span class="p">[</span><span class="n">photo</span><span class="o">.</span><span class="n">image_path</span><span class="p">]</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">scale_setting</span> <span class="o">=</span> <span class="n">scale_set_tuple</span><span class="o">.</span><span class="n">new_scale_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_scale_set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setup_resolution_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_viewer</span> <span class="o">=</span> <span class="n">ImageViewer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span> <span class="o">=</span> <span class="n">ScaleSettingWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_scales_accepted</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_scale_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">())</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QModelIndex</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">first</span><span class="p">,</span>
                                               <span class="n">end</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_photo_rotated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">photo</span><span class="p">:</span> <span class="n">TempPhoto</span><span class="p">,</span> <span class="n">clockwise</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="c1"># TODO REMOVE THIS</span>
        <span class="k">return</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">rotations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">dst_image_sizes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">dst_size</span>

        <span class="n">_photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">_fetch_photo</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">_photo</span><span class="o">.</span><span class="n">image_name</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">COL_ROTATION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="o">.</span><span class="n">_thumbnail_folder</span> <span class="o">/</span> <span class="n">_photo</span><span class="o">.</span><span class="n">image_name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="o">.</span><span class="n">load_thumbnail</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span> <span class="k">if</span> <span class="n">clockwise</span> <span class="k">else</span> <span class="mi">90</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="o">.</span><span class="n">reload_thumbnail</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_resize_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span> <span class="o">=</span> <span class="n">ResizeWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span> <span class="o">=</span> <span class="n">QDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Set image size&#39;</span><span class="p">)</span>
        <span class="n">vbox</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="n">vbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button_box</span> <span class="o">=</span> <span class="n">QDialogButtonBox</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span> <span class="o">|</span> <span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">button_box</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">invalid_input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_button_box</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">valid_input</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_button_box</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">button_box</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="c1">#vbox.addWidget(self._button_box)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">vbox</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_image_op</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">image_op</span><span class="o">.</span><span class="n">photo_rotated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_photo_rotated</span><span class="p">)</span>

<div class="viewcode-block" id="ImportDialog.handle_double_click_on_table"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.handle_double_click_on_table">[docs]</a>    <span class="k">def</span> <span class="nf">handle_double_click_on_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_SRC_SIZE</span> <span class="ow">or</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_DST_SIZE</span><span class="p">:</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">src_size</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">resize_factor</span><span class="p">,</span>
                                         <span class="n">max_factor</span><span class="o">=</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">max_resize_factor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">spboxFactor</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">resize_factor</span><span class="p">)</span>
            <span class="c1"># self._resize_widget.set_size(index.data(Qt.UserRole))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">setWindowModality</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WindowModal</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resize_dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span> <span class="o">==</span> <span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
                <span class="c1"># self.temp_storage.dst_image_sizes[index.row()] = (self._resize_widget.spboxWidth.value(),</span>
                <span class="c1">#                                                   self._resize_widget.spboxHeight.value())</span>
                <span class="c1"># self.temp_storage.photos[index.row()].import_info.dst_size = (self._resize_widget.spboxWidth.value(),</span>
                <span class="c1">#                                                               self._resize_widget.spboxHeight.value())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">[</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">()]</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_resize_widget</span><span class="o">.</span><span class="n">spboxFactor</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">COL_DST_SIZE</span><span class="p">),</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">COL_SCALE</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_SCALE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">showMaximized</span><span class="p">()</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_set_widget</span><span class="o">.</span><span class="n">image_viewer</span><span class="o">.</span><span class="n">set_photo</span><span class="p">(</span><span class="n">photo</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>
            <span class="c1"># self._scale_set_widget._fetch_photo(index.row())</span>

<div class="viewcode-block" id="ImportDialog.closeEvent"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg__1</span><span class="p">:</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QCloseEvent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scale_extraction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImportDialog.reject"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.reject">[docs]</a>    <span class="k">def</span> <span class="nf">reject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_setup_import_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblImageScale</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">grpLabelAssignments</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">removeWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">grpLabelAssignments</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjustSize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBoxImport</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBoxImport</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_find_input_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_find_output_clicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_extract_scale_clicked</span><span class="p">)</span>
        <span class="c1"># self.ui.btnExtractScale.hide()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_btn_clicked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_cancel_btn_clicked</span><span class="p">)</span>

        <span class="n">input_path_completer</span> <span class="o">=</span> <span class="n">QCompleter</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">filesys_model</span> <span class="o">=</span> <span class="n">QFileSystemModel</span><span class="p">(</span><span class="n">input_path_completer</span><span class="p">)</span>
        <span class="n">filesys_model</span><span class="o">.</span><span class="n">setFilter</span><span class="p">(</span><span class="n">QDir</span><span class="o">.</span><span class="n">AllDirs</span> <span class="o">|</span> <span class="n">QDir</span><span class="o">.</span><span class="n">Drives</span> <span class="o">|</span> <span class="n">QDir</span><span class="o">.</span><span class="n">NoDotAndDotDot</span><span class="p">)</span>
        <span class="n">input_path_completer</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">filesys_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="n">input_path_completer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_txtInput_changed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">textEdited</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_txtInput_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinboxNestLevel</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_txtInput_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>

        <span class="n">output_path_completer</span> <span class="o">=</span> <span class="n">QCompleter</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">output_path_completer</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">QFileSystemModel</span><span class="p">(</span><span class="n">output_path_completer</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setCompleter</span><span class="p">(</span><span class="n">output_path_completer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_txtOutput_changed</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_import_value_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_progress_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_item_delegate</span> <span class="o">=</span> <span class="n">AssignedLabelImageItemDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">model</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setItemDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_item_delegate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">([</span><span class="s2">&quot;Assigned&quot;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">])</span>

        <span class="c1">#self.ui.btnAddLabelImage.clicked.connect(self.add_new_label_image_for_import)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name_validator</span> <span class="o">=</span> <span class="n">QRegExpValidator</span><span class="p">()</span>
        <span class="n">reg_exp</span> <span class="o">=</span> <span class="n">QRegExp</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[^\t\r\n</span><span class="se">\\</span><span class="s1">\/&lt;&gt;:&quot;|?*]*[^\t\r\n</span><span class="se">\\</span><span class="s1">\/&lt;&gt;:&quot;|?*.\s]$&#39;</span><span class="p">)</span>  <span class="c1"># https://regex101.com/library/AUr9uv?orderBy=RELEVANCE&amp;search=windows+filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name_validator</span><span class="o">.</span><span class="n">setRegExp</span><span class="p">(</span><span class="n">reg_exp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_name_validator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_append_project_name_to_output_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabOrder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabOrder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabOrder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTabOrder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">setColumnStretch</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Original size&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Resizing factor&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;New size&quot;</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AlignHCenter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resize_settings</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">setVerticalScrollMode</span><span class="p">(</span><span class="n">QTableView</span><span class="o">.</span><span class="n">ScrollPerPixel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_handle_chkImportCount_stateChanged</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toggle_max_height_constraint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_max_height_constraint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_import_txtInput_changed</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>  <span class="c1"># To (re)set the list model and disable the parts of the GUI that shouldn&#39;t be active when no photo folder is initially selected.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagInfer</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_infer_tags_toggled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagGlobal</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_assign_global_tag_toggled</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtTagGlobal</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">handle_global_tag_changed</span><span class="p">)</span>
        <span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">(),</span> <span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;focusChanged(QWidget *, QWidget *)&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_focus_changed</span><span class="p">)</span>

<div class="viewcode-block" id="ImportDialog.toggle_max_height_constraint"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.toggle_max_height_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">toggle_max_height_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckState</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">set_max_size</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_DST_SIZE</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_SCALE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImportDialog.update_max_height_constraint"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.update_max_height_constraint">[docs]</a>    <span class="k">def</span> <span class="nf">update_max_height_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">set_max_size</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_DST_SIZE</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_SCALE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_handle_import_txtOutput_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># If a valid path has been selected as a folder for projects, remember it in config.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;projects_folder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;setting &quot;projects_folder&quot; to </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_lbl_project_dest</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>

<div class="viewcode-block" id="ImportDialog.update_lbl_project_dest"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.update_lbl_project_dest">[docs]</a>    <span class="k">def</span> <span class="nf">update_lbl_project_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="si">}</span><span class="s2"> is not a valid folder.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">out_path</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">out_path</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="si">}</span><span class="s1"> is not empty!&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Please give the project a name.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImportDialog.set_label_image_assignments"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.set_label_image_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">set_label_image_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lbl_img_assignments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lbl_img_assignments</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lbl_img_assignments</span><span class="p">):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">lbl_t</span><span class="p">,</span> <span class="n">assig</span> <span class="o">=</span> <span class="n">create_table_widget_row</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">assig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">tableLabelImages</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">lbl_t</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_update_lblImportImgCount_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">import_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span><span class="p">)</span> <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">])</span>
            <span class="c1"># self.ui.lblImportImgCount.setText(f&#39;{import_count} photo will be imported.&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">import_count</span><span class="si">}</span><span class="s1"> photo</span><span class="si">{</span><span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="n">import_count</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="si">}</span><span class="s1"> selected for import.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">import_count</span><span class="si">}</span><span class="s1"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span><span class="si">}</span><span class="s1"> photos selected for import.&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">import_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">import_count</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">PartiallyChecked</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">import_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.ui.lblImportImgCount.setText(&#39;&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;No photos found.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_chkImportCount_stateChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckState</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">PartiallyChecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">:</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_lblImportImgCount_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_import_txtInput_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s1">&#39;Please provide a valid folder.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinboxNestLevel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># TODO show hint that the folder does not exist.</span>
        <span class="c1"># if not Path(text).exists():</span>
        <span class="c1">#     return</span>
        <span class="c1"># contains_photos = _folder_contains_photos(Path(text))</span>
        <span class="n">photo_paths</span> <span class="o">=</span> <span class="n">_discover_photos_rec</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinboxNestLevel</span><span class="o">.</span><span class="n">value</span><span class="p">())</span>
        <span class="n">contains_photos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">photo_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">contains_photos</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">image_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">IMAGE_REFEX</span><span class="p">,</span> <span class="n">fname</span><span class="p">)]</span>
            <span class="c1"># image_paths: List[Path] = [Path(direntry.path) for direntry in os.scandir(path) if direntry.is_file() and re.match(IMAGE_REFEX, direntry.name)]</span>
            <span class="n">image_paths</span> <span class="o">=</span> <span class="n">photo_paths</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">close_storage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="o">=</span> <span class="n">TempStorage</span><span class="p">(</span><span class="n">image_paths</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                                            <span class="n">max_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span> <span class="o">=</span> <span class="n">ThumbnailStorage_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">,</span> <span class="n">thumbnail_size</span><span class="o">=</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">set_storage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setDefaultSectionSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="o">.</span><span class="n">thumbnail_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">32</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">verticalHeader</span><span class="p">()</span><span class="o">.</span><span class="n">setSectionResizeMode</span><span class="p">(</span><span class="n">QHeaderView</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="o">.</span><span class="n">thumbnail_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">setColumnWidth</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">170</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">grpImagesToImport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_assign_global_tag_toggled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagGlobal</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_infer_tags_toggled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagInfer</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">grpImagesToImport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">imageList</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">close_storage</span><span class="p">()</span>
                <span class="c1"># TODO call close_storage() on self.thumbnail_storage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># self.ui.btnBoxImport.button(QDialogButtonBox.Ok).setText(&#39;Create&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnBoxImport</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_lblImportImgCount_text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinboxNestLevel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_enable_import_button_if_inout_dirs_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">in_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">in_contains_images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">import_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span><span class="p">)</span> <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">import_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">in_contains_images</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">in_contains_images</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_folder_okay</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="ow">and</span> <span class="n">import_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_import_button_text</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos_to_import</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_output_folder_okay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">projects_folder_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="n">valid_project_name</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">project_folder_empty</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">valid_project_folder</span> <span class="o">=</span> <span class="n">project_folder_empty</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">ImportPhotos</span>

        <span class="k">return</span> <span class="n">projects_folder_exists</span> <span class="ow">and</span> <span class="n">valid_project_name</span> <span class="ow">and</span> <span class="n">valid_project_folder</span>

    <span class="k">def</span> <span class="nf">_handle_find_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_or_output</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">],</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]]):</span>
        <span class="n">maybe_path</span> <span class="o">=</span> <span class="n">choose_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open photo folder&quot;</span> <span class="k">if</span> <span class="n">input_or_output</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span> <span class="k">else</span> <span class="s2">&quot;Select new project folder&quot;</span><span class="p">,</span>
                                   <span class="n">path</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">input_or_output</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="p">)</span>
        <span class="n">text_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span> <span class="k">if</span> <span class="n">input_or_output</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span>
        <span class="k">if</span> <span class="n">maybe_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">text_field</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">maybe_path</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">input_or_output</span> <span class="o">==</span> <span class="s1">&#39;output&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_find_input_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_find_folder</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_import_image_copied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">Future</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_value_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_progress_value</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_import_progress_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_import_progress_value</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">ImportPhotos</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_photos</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_project</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_import_progress_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_value_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_find_output_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handle_find_folder</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset_import_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblImageScale</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images_to_copy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># self.ui.btnExtractScale.setText(TXT_EXTRACT_SCALE)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_switch_to_normal_state</span><span class="p">()</span>

        <span class="c1"># self.ui.lblNoImagesInfo.setVisible(False)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">completer</span><span class="p">()</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">setRootPath</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">completer</span><span class="p">()</span><span class="o">.</span><span class="n">model</span><span class="p">()</span><span class="o">.</span><span class="n">setRootPath</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblResizeImages</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">resizeLayout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">set_storage</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># self.thumbnail_storage.stop()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>

        <span class="c1"># Use a project folder path stored in config. Only use Path.home() if the config is not found or the path it specifies does not exist.</span>
        <span class="k">if</span> <span class="s2">&quot;projects_folder&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
            <span class="n">projects_folder_from_config</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;projects_folder&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">projects_folder_from_config</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">projects_folder_from_config</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">projects_folder_from_config</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">=</span> <span class="n">projects_folder_from_config</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_lblImportImgCount_text</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_append_project_name_to_output_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="n">project_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_lbl_project_dest</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_import_btn_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">in_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">out_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_folder</span><span class="p">(</span><span class="n">in_path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_switch_to_scale_extraction_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Cancel scale extraction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">disable_import_chkBoxes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_switch_to_normal_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnExtractScale</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">TXT_EXTRACT_SCALE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkBoxImportCount</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">enable_import_chkBoxes</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_cancel_scale_extraction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_stop_event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
                <span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_switch_to_normal_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_import_button_text</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_extract_scale_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scale_extraction</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.ui.btnFindInput.setEnabled(False)</span>
            <span class="c1"># self.ui.txtInput.setEnabled(False)</span>
            <span class="c1"># self.ui.btnExtractScale.setText(&#39;Cancel scale extraction&#39;)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">750</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="c1"># img_paths = [str(path) for path in self.temp_storage.image_paths]</span>
            <span class="n">img_paths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">src_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos_to_import</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognizing_in_progress</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_paths</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;scale rec left = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_import_button_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scale_recognition_left</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enable_import_button_if_inout_dirs_valid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_stop_event</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">mp_recognize_scales</span><span class="p">,</span>
                                                          <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">img_paths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_rec_queue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_stop_event</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scale_process</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_switch_to_scale_extraction_state</span><span class="p">()</span>

<div class="viewcode-block" id="ImportDialog.import_folder"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.import_folder">[docs]</a>    <span class="k">def</span> <span class="nf">import_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
        <span class="n">lbl_img_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lbl_img_types</span><span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;always_constrain_to&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;allow_constrain_to&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Labels&#39;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">lbl_img_types</span><span class="p">[</span><span class="s1">&#39;Reflections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;always_constrain_to&#39;</span><span class="p">:</span> <span class="s1">&#39;Labels&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allow_constrain_to&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

        <span class="n">lbls_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label_images&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">lbl_name</span><span class="p">:</span> <span class="n">lbl_info</span> <span class="k">for</span> <span class="n">lbl_name</span><span class="p">,</span> <span class="n">lbl_info</span> <span class="ow">in</span> <span class="n">lbl_img_types</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
                     <span class="s1">&#39;default_label_image&#39;</span><span class="p">:</span> <span class="s1">&#39;Labels&#39;</span><span class="p">}</span>

        <span class="n">restructure_folder</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">label_folders</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">lbl_img_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images_to_copy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">in_path</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">IMAGE_REFEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">images_to_copy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_to_copy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnCancel</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnImport</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">chkMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spboxMaxSize</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span> <span class="o">/</span> <span class="s1">&#39;label_images_info.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">lbls_info</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">present_img_fnames</span> <span class="o">=</span> <span class="p">{</span><span class="n">fname</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">out_path</span> <span class="o">/</span> <span class="s1">&#39;images&#39;</span><span class="p">)}</span>
        <span class="n">actual_image_fnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">photo</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">img_path</span> <span class="o">=</span> <span class="n">photo</span><span class="o">.</span><span class="n">image_path</span>
            <span class="n">dst_name</span> <span class="o">=</span> <span class="n">img_path</span><span class="o">.</span><span class="n">name</span>
            <span class="k">while</span> <span class="n">dst_name</span> <span class="ow">in</span> <span class="n">present_img_fnames</span><span class="p">:</span>
                <span class="n">dot_splits</span> <span class="o">=</span> <span class="n">dst_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">new_dst_name</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dot_splits</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_copy.&#39;</span> <span class="o">+</span> <span class="n">dot_splits</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dst_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">_image_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_dst_name</span>
                <span class="n">dst_name</span> <span class="o">=</span> <span class="n">new_dst_name</span>
            <span class="n">actual_image_fnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dst_name</span><span class="p">)</span>

            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">out_path</span> <span class="o">/</span> <span class="s1">&#39;images&#39;</span> <span class="o">/</span> <span class="n">dst_name</span>
            <span class="c1"># if self.temp_storage.image_sizes[i] != self.temp_storage.dst_image_sizes[i] or self.temp_storage.rotations[i] != 0:</span>
            <span class="k">if</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">src_size</span> <span class="o">!=</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">dst_size</span><span class="p">:</span>
                <span class="c1"># if photo.scale_setting is not None:</span>
                <span class="c1">#     mid = np.round(0.5 * np.array(photo.import_info.src_size))</span>
                <span class="c1">#     photo.scale_setting.scale_by_factor(photo.import_info.resize_factor, mid)</span>
                    <span class="c1"># photo.scale_setting.scale_line.scale(photo.import_info.resize_factor, mid)</span>
                <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
                    <span class="c1"># if self.temp_storage.image_sizes[i] != self.temp_storage.dst_image_sizes[i]:</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">dst_size</span><span class="p">,</span> <span class="n">resample</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="c1"># if self.temp_storage.rotations[i] != 0:</span>
                    <span class="c1">#     im = im.rotate(self.temp_storage.rotations[i] * -90, resample=2, expand=True)</span>
                    <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">)</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">image_path</span> <span class="o">=</span> <span class="n">dst_path</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">prgrImageCopying</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">==</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">ImportPhotos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_photos</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open_project</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImportDialog.open_for_creating_project"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.open_for_creating_project">[docs]</a>    <span class="k">def</span> <span class="nf">open_for_creating_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">CreateProject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Create a new project&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectsFolder</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImportDialog.open_for_importing"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.open_for_importing">[docs]</a>    <span class="k">def</span> <span class="nf">open_for_importing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_mode</span> <span class="o">=</span> <span class="n">ImportAction</span><span class="o">.</span><span class="n">ImportPhotos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">project_folder</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtProjectName</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindOutput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">btnFindInput</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">spinBoxImageScale</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Import photos&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lblProjectDestination</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_projects_folder</span> <span class="o">=</span> <span class="n">project_folder</span><span class="o">.</span><span class="n">parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_handle_cancel_btn_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_import_dialog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handle_import_status_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">photo_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">will_import</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_lblImportImgCount_text</span><span class="p">()</span>

<div class="viewcode-block" id="ImportDialog.handle_infer_tags_toggled"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.handle_infer_tags_toggled">[docs]</a>    <span class="k">def</span> <span class="nf">handle_infer_tags_toggled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calling import_dialog.handle_infer_tags_toggled(</span><span class="si">{</span><span class="n">checked</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checked</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">:</span>
            <span class="c1"># photo.tags = {&#39;_&#39;.join(photo.import_info.relative_path.parent.parts)}</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">relative_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">root_folder</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_PHOTO_TAG</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_PHOTO_TAG</span><span class="p">))</span></div>

<div class="viewcode-block" id="ImportDialog.handle_assign_global_tag_toggled"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.handle_assign_global_tag_toggled">[docs]</a>    <span class="k">def</span> <span class="nf">handle_assign_global_tag_toggled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;calling import_dialog.handle_assign_global_tag_toggled(</span><span class="si">{</span><span class="n">checked</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checked</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">photos</span><span class="p">:</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtTagGlobal</span><span class="o">.</span><span class="n">text</span><span class="p">()}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_PHOTO_TAG</span><span class="p">),</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">image_list_model</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_storage</span><span class="o">.</span><span class="n">image_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_PHOTO_TAG</span><span class="p">))</span></div>

<div class="viewcode-block" id="ImportDialog.handle_global_tag_changed"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.handle_global_tag_changed">[docs]</a>    <span class="k">def</span> <span class="nf">handle_global_tag_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;calling import_dialog.handle_global_tag_changed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_assign_global_tag_toggled</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagGlobal</span><span class="o">.</span><span class="n">isChecked</span><span class="p">())</span></div>

<div class="viewcode-block" id="ImportDialog.handle_focus_changed"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImportDialog.handle_focus_changed">[docs]</a>    <span class="k">def</span> <span class="nf">handle_focus_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">now</span><span class="p">):</span>
        <span class="c1"># print(&quot;calling import_dialog.handle_focus_changed:&quot;)</span>
        <span class="c1"># print(self)</span>
        <span class="c1"># print(old)</span>
        <span class="c1"># print(now)</span>
        <span class="c1"># print(&quot; &quot;)</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">txtTagGlobal</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">rbtnTagGlobal</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="create_table_widget_row"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.create_table_widget_row">[docs]</a><span class="k">def</span> <span class="nf">create_table_widget_row</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">LabelImgType</span><span class="p">],</span> <span class="n">assigned</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">QTableWidgetItem</span><span class="p">]:</span>
    <span class="n">name_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">name_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">label_type</span><span class="p">,</span> <span class="n">LabelImgType</span><span class="p">):</span>
        <span class="n">label_type_str</span> <span class="o">=</span> <span class="n">LabelImgType</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">label_type</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">label_type</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">label_type_str</span> <span class="o">=</span> <span class="n">LabelImgType</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">[</span><span class="n">label_type</span><span class="p">]</span>
        <span class="n">label_type</span> <span class="o">=</span> <span class="n">LabelImgType</span><span class="p">(</span><span class="n">label_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_type_str</span> <span class="o">=</span> <span class="n">label_type</span>
        <span class="n">label_type</span> <span class="o">=</span> <span class="n">LabelImgType</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">label_type_str</span><span class="p">]</span>
    <span class="n">label_type_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="n">label_type_str</span><span class="p">)</span>
    <span class="n">label_type_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">label_type</span><span class="p">)</span>
    <span class="n">assigned_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">assigned_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">assigned</span><span class="p">)</span>
    <span class="n">assigned_item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span><span class="p">)</span>
    <span class="n">assigned_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">assigned</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">name_item</span><span class="p">,</span> <span class="n">label_type_item</span><span class="p">,</span> <span class="n">assigned_item</span><span class="p">]</span></div>


<div class="viewcode-block" id="AssignedLabelImageItemDelegate"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.AssignedLabelImageItemDelegate">[docs]</a><span class="k">class</span> <span class="nc">AssignedLabelImageItemDelegate</span><span class="p">(</span><span class="n">QStyledItemDelegate</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">QAbstractItemModel</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">QObject</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">QStyledItemDelegate</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="p">:</span> <span class="n">QAbstractItemModel</span> <span class="o">=</span> <span class="n">model</span>

<div class="viewcode-block" id="AssignedLabelImageItemDelegate.createEditor"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.AssignedLabelImageItemDelegate.createEditor">[docs]</a>    <span class="k">def</span> <span class="nf">createEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">option</span><span class="p">:</span> <span class="n">QStyleOptionViewItem</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">QModelIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QWidget</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QLineEdit</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">QComboBox</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span></div>

<div class="viewcode-block" id="AssignedLabelImageItemDelegate.setEditorData"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.AssignedLabelImageItemDelegate.setEditorData">[docs]</a>    <span class="k">def</span> <span class="nf">setEditorData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">:</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">editor</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">LabelImgType</span><span class="o">.</span><span class="n">_member_names_</span><span class="p">:</span>
                <span class="n">editor</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">editor</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_model</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span></div>

<div class="viewcode-block" id="AssignedLabelImageItemDelegate.setModelData"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.AssignedLabelImageItemDelegate.setModelData">[docs]</a>    <span class="k">def</span> <span class="nf">setModelData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editor</span><span class="p">:</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">QAbstractItemModel</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">QModelIndex</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">LabelImgType</span><span class="o">.</span><span class="n">_member_map_</span><span class="p">[</span><span class="n">editor</span><span class="o">.</span><span class="n">currentText</span><span class="p">()],</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
            <span class="n">model</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div></div>


<span class="k">def</span> <span class="nf">_folder_contains_photos</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># TODO what about non-existent folder?</span>
    <span class="k">for</span> <span class="n">file_entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">IMAGE_REFEX</span><span class="p">,</span> <span class="n">file_entry</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">_discover_photos</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
    <span class="n">image_paths</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">file_entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">file_entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">IMAGE_REFEX</span><span class="p">,</span> <span class="n">file_entry</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="n">image_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">file_entry</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">image_paths</span>


<span class="k">def</span> <span class="nf">_discover_photos_rec</span><span class="p">(</span><span class="n">folder</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">nest_level</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">folder</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
    <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">folder</span><span class="p">,</span> <span class="n">nest_level</span><span class="p">))</span>

    <span class="n">discovered_image_paths</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">queue</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="n">curr_folder</span><span class="p">,</span> <span class="n">curr_level</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">curr_level</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">discovered_image_paths</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_discover_photos</span><span class="p">(</span><span class="n">curr_folder</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">f_entry</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">curr_folder</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f_entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">Path</span><span class="p">(</span><span class="n">f_entry</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">curr_level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">discovered_image_paths</span>


<div class="viewcode-block" id="ImageImportTableModel"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel">[docs]</a><span class="k">class</span> <span class="nc">ImageImportTableModel</span><span class="p">(</span><span class="n">QAbstractTableModel</span><span class="p">):</span>
    <span class="n">import_status_changed</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">([</span><span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TempStorage</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ThumbnailStorage_</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk_boxes_enabled</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="ImageImportTableModel.rowCount"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.rowCount">[docs]</a>    <span class="k">def</span> <span class="nf">rowCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">image_count</span></div>

<div class="viewcode-block" id="ImageImportTableModel.columnCount"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.columnCount">[docs]</a>    <span class="k">def</span> <span class="nf">columnCount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">:</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="o">=</span><span class="n">QModelIndex</span><span class="p">())</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span></div>

<div class="viewcode-block" id="ImageImportTableModel.headerData"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.headerData">[docs]</a>    <span class="k">def</span> <span class="nf">headerData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">section</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">orientation</span><span class="p">:</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Orientation</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Vertical</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_IMPORT</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Import&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_THUMB</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Preview&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_NAME</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Image name&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_SRC_SIZE</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Original size (px)&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_DST_SIZE</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;New size (px)&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_SCALE</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Scale&quot;</span>
        <span class="c1"># elif section == COL_ROTATION and role == Qt.DisplayRole:</span>
        <span class="c1">#     return &quot;Rotation&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_SCALE_MARKER</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Scale marker&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_REF_LENGTH</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Reference length&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_PHOTO_FOLDER</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Folder&quot;</span>
        <span class="k">elif</span> <span class="n">section</span> <span class="o">==</span> <span class="n">COL_PHOTO_TAG</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Tags&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ImageImportTableModel.data"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.data">[docs]</a>    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span><span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
        <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_IMPORT</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span> <span class="k">if</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span> <span class="k">else</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_THUMB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DecorationRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_NAME</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="c1"># return self.storage.image_names[index.row()]</span>
                <span class="k">return</span> <span class="n">photo</span><span class="o">.</span><span class="n">image_name</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_SRC_SIZE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="c1"># return str(self.storage.image_sizes[index.row()])</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">src_size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">:</span>
                <span class="c1"># return self.storage.image_sizes[index.row()]</span>
                <span class="k">return</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">src_size</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_DST_SIZE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="c1"># return str(self.storage.dst_image_sizes[index.row()])</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">dst_size</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">UserRole</span><span class="p">:</span>
                <span class="c1"># return self.storage.image_sizes[index.row()]</span>
                <span class="k">return</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">dst_size</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_SCALE</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="c1"># photo = self.storage.get_photo_by_idx(index.row(), load_image=False)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">scale</span> <span class="o">:=</span> <span class="n">photo</span><span class="o">.</span><span class="n">image_scale</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">scale</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s2">&quot;not set&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1"># elif index.column() == COL_ROTATION:</span>
        <span class="c1">#     if role == Qt.DisplayRole:</span>
        <span class="c1">#         if (rot := photo.import_info.rotation) == 0 or abs(rot == 4):</span>
        <span class="c1">#             return &quot;no rotation&quot;</span>
        <span class="c1">#         elif rot &gt; 0:</span>
        <span class="c1">#             return f&quot;{rot * 90}° CW&quot;</span>
        <span class="c1">#         else:</span>
        <span class="c1">#             return f&quot;{abs(rot) * 90}° CCW&quot;</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_SCALE_MARKER</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DecorationRole</span><span class="p">:</span>
                <span class="c1"># return self.storage.get_photo_by_idx(index.row(), load_image=False).scale_marker</span>
                <span class="k">return</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">scale_marker</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SizeHintRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">QSize</span><span class="p">(</span><span class="mi">154</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_REF_LENGTH</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="c1"># return str(self.storage.get_photo_by_idx(index.row(), load_image=False).ref_length)</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">scale_info</span><span class="o">.</span><span class="n">reference_length</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">BackgroundRole</span> <span class="ow">and</span> <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">scale_info</span><span class="o">.</span><span class="n">reference_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#self.storage.get_photo_by_idx(index.row(), False).ref_length is None:</span>
                <span class="k">return</span> <span class="n">QColor</span><span class="o">.</span><span class="n">fromRgb</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_PHOTO_FOLDER</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">relative_path</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_PHOTO_TAG</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">DisplayRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;no tag&quot;</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ForegroundRole</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">QColor</span><span class="o">.</span><span class="n">fromRgb</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ImageImportTableModel.flags"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.flags">[docs]</a>    <span class="k">def</span> <span class="nf">flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemFlags</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_IMPORT</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chk_boxes_enabled</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">NoItemFlags</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_PHOTO_TAG</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEditable</span>
        <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsSelectable</span></div>

<div class="viewcode-block" id="ImageImportTableModel.enable_import_chkBoxes"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.enable_import_chkBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">enable_import_chkBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk_boxes_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageImportTableModel.disable_import_chkBoxes"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.disable_import_chkBoxes">[docs]</a>    <span class="k">def</span> <span class="nf">disable_import_chkBoxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chk_boxes_enabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">COL_IMPORT</span><span class="p">),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">)</span></div>

<div class="viewcode-block" id="ImageImportTableModel.setData"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.setData">[docs]</a>    <span class="k">def</span> <span class="nf">setData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">PySide2</span><span class="o">.</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QModelIndex</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># if index.column() != COL_IMPORT or role != Qt.CheckStateRole:</span>
        <span class="c1">#     return False</span>
        <span class="k">if</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_IMPORT</span> <span class="ow">and</span> <span class="n">role</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CheckStateRole</span><span class="p">:</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">import_info</span><span class="o">.</span><span class="n">include</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_status_changed</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">index</span><span class="o">.</span><span class="n">column</span><span class="p">()</span> <span class="o">==</span> <span class="n">COL_PHOTO_TAG</span><span class="p">:</span>
            <span class="n">photo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">get_photo_by_idx</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">row</span><span class="p">(),</span> <span class="n">load_image</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">photo</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

    <span class="c1"># def set_thumbnail_storage(self, thumbnails: ThumbnailStorage_):</span>
    <span class="c1">#     self.thumbnail_storage = thumbnails</span>
    <span class="c1">#     # self.thumbnail_storage.thumbnails_loaded.connect(self._update_thumbnail_column)</span>

<div class="viewcode-block" id="ImageImportTableModel.set_storage"><a class="viewcode-back" href="../../arthropod_describer.html#arthropod_describer.import_dialog.ImageImportTableModel.set_storage">[docs]</a>    <span class="k">def</span> <span class="nf">set_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">:</span> <span class="n">TempStorage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beginResetModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endResetModel</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_thumbnail_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idxs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="n">first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">COL_THUMB</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">COL_THUMB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="n">Qt</span><span class="o">.</span><span class="n">DecorationRole</span><span class="p">])</span></div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, CBIA @ FI MUNI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>